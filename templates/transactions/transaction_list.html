{% extends 'base.html' %}

{% block title %}–¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏{% endblock %}

{% block content %}
<div class="container">
    <div class="header-row">
        <h1>–¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏</h1>
        <a href="{% url 'transaction_create' %}" class="btn btn-primary">
            <span>+</span>
            –î–æ–±–∞–≤–∏—Ç—å —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—é
        </a>
    </div>

    <!-- –§–∏–ª—å—Ç—Ä—ã -->
    <form method="get" class="filter-form">
        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem;">
            <div class="form-group">
                <select name="type" onchange="this.form.submit()" class="form-select">
                    <option value="">–í—Å–µ —Ç–∏–ø—ã</option>
                    <option value="income" {% if request.GET.type == 'income' %}selected{% endif %}>–î–æ—Ö–æ–¥—ã</option>
                    <option value="expense" {% if request.GET.type == 'expense' %}selected{% endif %}>–†–∞—Å—Ö–æ–¥—ã</option>
                </select>
            </div>
            
            <div class="form-group">
                <select name="category" onchange="this.form.submit()" class="form-select">
                    <option value="">–í—Å–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏</option>
                    {% for category in categories %}
                    <option value="{{ category.id }}" {% if request.GET.category == category.id|stringformat:"i" %}selected{% endif %}>
                        {{ category.name }}
                    </option>
                    {% endfor %}
                </select>
            </div>
            
            <div class="form-group">
                <select name="ordering" onchange="this.form.submit()" class="form-select">
                    <option value="-date" {% if request.GET.ordering == '-date' %}selected{% endif %}>–°–Ω–∞—á–∞–ª–∞ –Ω–æ–≤—ã–µ</option>
                    <option value="date" {% if request.GET.ordering == 'date' %}selected{% endif %}>–°–Ω–∞—á–∞–ª–∞ —Å—Ç–∞—Ä—ã–µ</option>
                    <option value="amount" {% if request.GET.ordering == 'amount' %}selected{% endif %}>–ü–æ —Å—É–º–º–µ ‚Üë</option>
                    <option value="-amount" {% if request.GET.ordering == '-amount' %}selected{% endif %}>–ü–æ —Å—É–º–º–µ ‚Üì</option>
                </select>
            </div>
            
            <div class="form-group">
                <input type="date" name="date_from" value="{{ request.GET.date_from }}" 
                       placeholder="–û—Ç –¥–∞—Ç—ã" class="form-input">
            </div>
            
            <div class="form-group">
                <input type="date" name="date_to" value="{{ request.GET.date_to }}" 
                       placeholder="–î–æ –¥–∞—Ç—ã" class="form-input">
            </div>
        </div>
        
        <div style="display: flex; gap: 0.75rem; margin-top: 1rem;">
            <button type="submit" class="btn btn-primary">–ü—Ä–∏–º–µ–Ω–∏—Ç—å</button>
            <a href="{% url 'transaction_list' %}" class="btn">–°–±—Ä–æ—Å–∏—Ç—å</a>
        </div>
    </form>

 
    {% if transactions %}
        <!-- –ò—Ç–æ–≥–∏ -->
    <table class="table" >
        <tbody>
            <tr class="table-totals">
                <td colspan="3"><strong>–ò—Ç–æ–≥–æ:</strong></td>
                <td class="income"><strong>{{ total_income }}</strong></td>
                <td class="expense"><strong>{{ total_expense }}</strong></td>
                <td>
                    <strong>–ë–∞–ª–∞–Ω—Å: 
                        <span style="color: {% if balance >= 0 %}var(--success){% else %}var(--danger){% endif %};">
                            {{ balance }}
                        </span>
                    </strong>
                </td>
            </tr>
        </tbody>
    </table>
   <!-- –¢–∞–±–ª–∏—Ü–∞ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π -->    
    <table class="table">
        <thead>
            <tr>
                <th>–î–∞—Ç–∞</th>
                <th>–ö–∞—Ç–µ–≥–æ—Ä–∏—è</th>
                <th>–û–ø–∏—Å–∞–Ω–∏–µ</th>
                <th>–°—É–º–º–∞</th>
                <th>–¢–∏–ø</th>
                <th style="width: 100px;">–î–µ–π—Å—Ç–≤–∏—è</th>
            </tr>
        </thead>
        <tbody>
            {% for transaction in transactions %}
            <tr>
                <td>{{ transaction.date|date:"d.m.Y" }}</td>
                <td>
                    <span style="font-weight: 500;">{{ transaction.category.name }}</span>
                </td>
                <td>
                    <span style="color: var(--secondary);">
                        {{ transaction.description|default:"‚Äî"|truncatechars:30 }}
                    </span>
                </td>
                <td class="{% if transaction.type == 'income' %}income{% else %}expense{% endif %}">
                    {{ transaction.amount }}
                </td>
                <td>
                    <span class="badge {% if transaction.type == 'income' %}badge-success{% else %}badge-danger{% endif %}">
                        {{ transaction.get_type_display }}
                    </span>
                </td>
                <td>
                    <div style="display: flex; gap: 0.5rem;">
                        <a href="{% url 'transaction_update' transaction.pk %}" 
                           class="btn btn-sm" 
                           title="–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å">
                            ‚úèÔ∏è
                        </a>
                        <a href="{% url 'transaction_delete' transaction.pk %}" 
                           class="btn btn-danger btn-sm"
                           onclick="return confirm('–£–¥–∞–ª–∏—Ç—å —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—é?')"
                           title="–£–¥–∞–ª–∏—Ç—å">
                            üóëÔ∏è
                        </a>
                    </div>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
    

    {% else %}
    <div class="empty-state">
        <div class="empty-state-icon">üí∏</div>
        <p class="empty-state-text">–¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–π –Ω–µ –Ω–∞–π–¥–µ–Ω–æ</p>
        <p style="color: var(--secondary); margin-bottom: 1.5rem; font-size: 0.875rem;">
            –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –∏–∑–º–µ–Ω–∏—Ç—å –ø–∞—Ä–∞–º–µ—Ç—Ä—ã —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏
        </p>
        <a href="{% url 'transaction_list' %}" class="btn">–°–±—Ä–æ—Å–∏—Ç—å —Ñ–∏–ª—å—Ç—Ä—ã</a>
    </div>
    {% endif %}
</div>
{% endblock %}